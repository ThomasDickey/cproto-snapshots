.\" $Id: cproto.1,v 4.29 2025/09/01 19:03:32 tom Exp $
.\"
.TH CPROTO 1 2025-09-01 "Version 4.7y" "User commands"
.de bP
.ie n  .IP \(bu 4
.el    .IP \(bu 2
..
.ie n .ds CW R
.el   \{
.ie \n(.g .ds CW CR
.el       .ds CW CW
.\}
.de Ex
.RS +7
.PP
.nf
.ft \*(CW
..
.de Ee
.fi
.ft R
.RE
..
.ie \n(.g \{\
.ds `` \(lq
.ds '' \(rq
.\}
.el \{\
.ie t .ds `` ``
.el   .ds `` ""
.ie t .ds '' ''
.el   .ds '' ""
.\}",
.
.SH NAME
cproto \-
generate C function prototypes and convert function definitions
.SH SYNOPSIS
.B cproto
[
.I option \fP...\fI
] [
.I file \fP...\fI
]
.
.SH DESCRIPTION
.SS "Extracting"
.B Cproto
generates function prototypes for
functions defined in the specified C source files to the standard output.
The function definitions may be in the old style or ANSI C style.
Optionally,
.B cproto
also outputs declarations for variables defined in the files.
If no
.I file
argument is given,
.B cproto
reads its input from the standard input.
.SS "Converting ANSI C"
.B Cproto
can convert function definitions in simple source files from the
old style to the ANSI C style (see \fIBUGS\fP for limitations).
The original source files along with files specified by
.Ex
#include "file"
.Ee
.PP
directives appearing in the source code will be overwritten
with the converted code.
If no file names are given on the command line, then the program reads
the source code from the standard input and outputs the converted source
to the standard output.
.LP
If any comments appear in the parameter declarations for a function definition,
such as in the example,
.Ex
main (argc, argv)
int argc;       /* number of arguments */
char *argv[];   /* arguments */
{
}
.Ee
.PP
then the converted function definition will have the form
.Ex
int
main (
    int argc,       /* number of arguments */
    char *argv[]   /* arguments */
)
{
}
.Ee
.PP
Otherwise, the converted function definition will look like
.Ex
int
main (int argc, char *argv[])
{
}
.Ee
.SS Converting K&R C
.B Cproto
can convert function definitions from the ANSI style to the old K&R style.
In this mode, the program also converts function declarators and prototypes
that appear outside function bodies.
This is not a complete ANSI C to old C conversion.
The program does not change anything within function bodies.
.SS "Lint\-libraries"
.B Cproto
can optionally generate source in lint\-library format.
This is useful in environments where the \fBlint\fR utility is
used to supplement prototype checking of your program.
.
.SH OPTIONS
.TP
.B \-a
Convert function definitions from the old style to the ANSI C style.
.TP
.BI \-B " directive"
Set the conditional compilation directive to output at the beginning of
function definitions generated by the \-b option.
The default is
.Ex
#ifdef ANSI_FUNC
.Ee
.TP
.B \-b
Rewrite function definition heads to include both old style and new style
declarations separated by a conditional compilation directive.
For example, the program can generate this function definition:
.Ex
#ifdef ANSI_FUNC

int
main (int argc, char *argv[])
#else

int
main (argc, argv)
int argc;
char *argv[]
#endif
{
}
.Ee
.TP
.BI \-C " template"
Set the output format for function definitions with parameter comments.
The \-F and \-P options allow setting the format
for prototypes and function definitions.
.IP
The format is specified by a template in the form
.Ex
" int f ( a, b )"
.Ee
.IP
but you may replace each space in this string with any number of
whitespace characters.
For example, the option
.Ex
\-F"int f(\\n\\ta,\\n\\tb\\n\\t)"
.Ee
.IP
will produce
.Ex
int main(
        int argc,
        char *argv[]
        )
.Ee
.TP
.B \-c
The parameter comments in the prototypes generated by
the \-f1 and \-f2 options are omitted by default.
Use this option to enable the output of these comments.
.TP
.BI \-D " name[=value]"
This option is passed through to the preprocessor and is used to define
symbols for use with conditionals such as
.IR #ifdef .
.TP
.B \-d
Omit the definition of the prototype macro used by the \-m option.
.TP
.BI \-E " cpp"
Pipe the input files through the specified C preprocessor command
when generating prototypes.
By default, the program uses \*(``/lib/cpp\*('' via a pipe.
.TP
.BI \-E " 0"
Do not run the C preprocessor.
.TP
.B \-e
Output the keyword
.B extern
in front of every generated prototype or declaration that has global scope.
.TP
.BI \-F " template"
Set the output format for function definitions as in the \*(``\-C\*('' option.
.TP
.BI \-f " n"
Set the style of generated function prototypes where
.I n
is a number from 0 to 3.
For example, consider the function definition
.Ex
main (argc, argv)
int argc;
char *argv[];
{
}
.Ee
.IP
If the value is 0, then no prototypes are generated.
When set to 1, the output is:
.Ex
int main(/*int argc, char *argv[]*/);
.Ee
.IP
For a value of 2, the output has the form:
.Ex
int main(int /*argc*/, char */*argv*/[]);
.Ee
.IP
The default value is 3.
It produces the full function prototype:
.Ex
int main(int argc, char *argv[]);
.Ee
.TP
.BI \-I " directory"
This option is passed through to the preprocessor and is used to specify
a directory to search for files that are referenced with
.IR #include .
.TP
.B \-i
By default,
.B cproto
only generates declarations for functions and variables having global scope.
This option will output
.B inline
declarations as well.
.TP
.B \-l
Generate text for a lint\-library (overrides the \*(``\fB\-f\fR\*('' option).
The output includes the comment
.Ex
/* LINTLIBRARY */
.Ee
.IP
Special comments LINT_EXTERN and LINT_PREPRO (a la \*(``VARARGS\*('')
respectively turn on the \*(``\-x\*(''
option and copy comment\-text to the output (for preprocessing in \fBlint\fR).
Use the comment
.Ex
/* LINT_EXTERN2 */
.Ee
.IP
to include externs defined in the first level of include\-files.
Use the comment
.Ex
/* LINT_SHADOWED */
.Ee
.IP
to cause
.B cproto
to put \*(``#undef\*('' directives before each lint library declaration
(i.e., to avoid conflicts with macros that happen to have to have
the same name as the functions, thus causing syntax errors).
.IP
Note that these special comments
are not supported under VAX/VMS, since there is no
equivalent for the \*(``\-C\*('' option of the C preprocessor with VAX\-C.
.TP
.BI \-M " name"
Set the name of the macro used to surround prototype parameter lists
when option \-m is selected.
The default is \*(``P_\*(''.
.TP
.B \-m
Put a macro around the parameter list of every generated prototype.
For example:
.Ex
int main P_((int argc, char *argv[]));
.Ee
.TP
.BI \-N " name"
Rather than filling in \*(``void\*('' for functions without parameters,
use the given \fIname\fP.
.TP
.B \-n
Rather than filling in \*(``void\*('' for functions without parameters,
use a comment \*(``/*empty*/\*(''.
.TP
.BI \-O " file"
Specify the name of the error file (default: standard error).
.TP
.BI \-o " file"
Specify the name of the output file (default: standard output).
.TP
.BI \-P " template"
Set the output format for generated prototypes as in the \*(``\-C\*('' option.
.TP
.B \-p
Disable promotion of formal parameters in old style function definitions.
By default, parameters of type
.B char
or
.B short
in old style function definitions are promoted to type
.B int
in the function prototype or converted ANSI C function definition.
Parameters of type
.B float
get promoted to
.B double
as well.
.TP
.B \-q
Do not output any error messages when the program cannot read the
file specified in an
.I #include
directive.
.TP
.B \-S
Output only static declarations.
.TP
.B \-s
By default,
.B cproto
only generates declarations for functions and variables having global scope.
This option will output
.B static
declarations as well.
.TP
.B \-T
Copy type definitions from each file.
(Definitions in included\-files are copied, unlike the \*(``\-l\*('' option).
.TP
.B \-t
Convert function definitions from the ANSI C style to the traditional style.
.TP
.BI \-U " name"
This option is passed through to the preprocessor and is used to remove
any definitions of this symbol.
.TP
.B \-V
Print version information.
.TP
.B \-v
Also output declarations for variables defined in the source.
.TP
.BI \-X " level"
This option limits the include\-file level from which declarations are extracted
by examining the preprocessor output.
.TP
.B \-x
This option causes procedures and variables which are declared \*(``extern\*(''
to be included in the output.
.
.SH ENVIRONMENT
The environment variable CPROTO is scanned for
a list of options in the same format as the command line options.
Options given on the command line override any corresponding
environment option.
.
.SH BUGS
If an un\-tagged struct, union or enum declaration appears in
a generated function prototype or converted function definition,
the content of the declaration between the braces is empty.
.LP
The program does not pipe the source files through the C preprocessor when
it is converting function definitions (i.e., options \-a, \-b, \-t).
That is because \fBcproto\fP does the conversion by replacing strings,
rather than by converting to/from lexical tokens.
Instead of using the C preprocessor,
\fBcproto\fP tries to handle preprocessor directives and macros itself,
to find type definitions.
There are several limitations as a result:
.bP
the search-path for included files contains only \*(``/usr/include\*(''
and the directories listed by \*(``-I\*('' options.
.bP
conditional directives (e.g., \*(``#if\*('') are ignored.
.bP
only macros without parameters are handled.
.bP
some comments in the function definition head are discarded.
.LP
The \-v option does not generate declarations for variables defined with the
.B extern
specifier.
This does not strictly conform to the C language standard but this rule
was implemented because include files commonly declare variables this way.
.LP
When the program encounters an error, it usually outputs the not very
descriptive message \*(``syntax error\*(''.
(Your configuration may allow the extended error reporting in yyerror.c).
.LP
Options that take string arguments only interpret the following
character escape sequences:
.Ex
\\n	newline
\\s	space
\\t	tab
.Ee
.LP
VARARGS comments are not passed through on systems whose C preprocessors
do not support this (e.g., VAX/VMS, MS\-DOS).
.
.SH AUTHORS
.nf
Chin Huang
cthuang@vex.net
cthuang@interlog.com
.sp
Thomas E. Dickey
dickey@invisible\-island.net
modifications to support lint library, type\-copying, and port to VAX/VMS.
.fi
.
.SH "SEE ALSO"
cc(1),
cpp(1)
