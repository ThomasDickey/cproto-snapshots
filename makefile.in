# $Id: makefile.in,v 3.3 1994/07/26 22:43:53 tom Exp $
#
# UNIX template-makefile for C prototype generator

CC		= @CC@
CPP		= @CPP@
INSTALL		= @INSTALL@
INSTALL_PROGRAM	= @INSTALL_PROGRAM@
INSTALL_DATA	= @INSTALL_DATA@
CFLAGS		= @CC_OPTS@ -DHAVE_CONFIG_H
LIBS		= @LIBS@

LEX = lex		# "lex" or "flex"
YACC = yacc		# "yacc" or "bison -y"

DIST1 = README CHANGES cproto.man
DIST2 = cproto.1 borland.mak micrsoft.mak makefile.in lex.l grammar.y
DIST3 = system.h cproto.h patchlev.h semantic.h symbol.h
DIST4 = cproto.c popen.c lintlibs.c semantic.c strkey.c strstr.c symbol.c

OBJECTS = cproto.o lintlibs.o semantic.o strkey.o strstr.o symbol.o y.tab.o

all : cproto cproto.man

cproto : $(OBJECTS)
	$(CC) $(CFLAGS) -o $@ $(OBJECTS) $(LIBS)

y.tab.c : grammar.y
	$(YACC) grammar.y

lex.yy.c : lex.l
	$(LEX) lex.l

cproto.man : cproto.1
	nroff -man cproto.1 >$@

clean :
	rm -f *.o *.bak *.log *.man *.out y.tab.c lex.yy.c tags

clobber : clean
	rm -f cproto

distclean : clobber
	rm -f stamp_h config.status config.h makefile

# configure might not change config.h
config.h : stamp-h
stamp-h : config.status
	./config.status
	touch stamp-h

makefile: makefile.in config.status
	./config.status

config.status : configure
	./config.status --recheck

configure : configure.in
	autoconf

shar:
	shar $(DIST1) $(DIST2) >cproto.sh1
	shar $(DIST3) $(DIST4) >cproto.sh2

default.h: $(DIST4)
	./cproto -e -v -m $(DEFINES) -UNEEDED cproto.c lintlibs.c semantic.c strkey.c symbol.c grammar.y >$@

lint: $(DIST4)
	tdlint $(DEFINES) -lyacc cproto.c lintlibs.c semantic.c strkey.c symbol.c y.tab.c >lint.out
llib:
	./cproto -l $(DEFINES) cproto.c lintlibs.c semantic.c strkey.c symbol.c y.tab.c >$@.out

tags: $(DIST3) $(DIST4)
	ctags -t $(DIST3) $(DIST4)
depend:
	makedepend $(DIST4) y.tab.c

# DO NOT DELETE THIS LINE -- make depend depends on it.

cproto.o: cproto.h config.h system.h patchlev.h
lintlibs.o: cproto.h config.h system.h semantic.h symbol.h
semantic.o: cproto.h config.h system.h semantic.h
strkey.o: cproto.h config.h system.h 
strstr.o: config.h
symbol.o: cproto.h config.h system.h symbol.h
y.tab.o: cproto.h config.h system.h symbol.h semantic.h lex.yy.c
